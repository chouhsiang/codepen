<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  

    <link rel="apple-touch-icon" type="image/png" href="https://cpwebassets.codepen.io/assets/favicon/apple-touch-icon-5ae1a0698dcc2402e9712f7d01ed509a57814f994c660df9f7a952f3060705ee.png" />

    <meta name="apple-mobile-web-app-title" content="CodePen">

    <link rel="shortcut icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico" />

    <link rel="mask-icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/logo-pin-b4b4269c16397ad2f0f7a01bcdf513a1994f4c94b8af2f191c09eb0d601762b1.svg" color="#111" />



  
    <script src="https://cpwebassets.codepen.io/assets/common/stopExecutionOnTimeout-2c7831bb44f98c1391d6a4ffda0e1fd302503391ca806e7fcc7b9b87197aec26.js"></script>


  <title>CodePen - ChtICToken.js 自然人憑證數位簽章</title>

    <link rel="canonical" href="https://codepen.io/chouhsiang/pen/poXGNPx">
  
  
  
  

  <script>
  window.console = window.console || function(t) {};
</script>

  
  
</head>

<body translate="no">
  <h1>自然人憑證 數位簽章</h1>
signatureType: <select id="signatureType">
  <option value="PKCS1" selected>PKCS1</option>
  <option value="PKCS7">PKCS7</option>
  <option value="RAW">RAW</option>
</select><br>
tbs: <input type="text" id="tbs" /><br>
pin: <input type="text" id="pin" /><br>
hashAlgorithm: <select id="hashAlgorithm">
  <option value="SHA1">SHA1</option>
  <option value="SHA256" selected>SHA256</option>
  <option value="SHA384">SHA384</option>
  <option value="SHA512">SHA512</option>
</select><br><br>
<b>PKCS7 專用</b><br>
nonce: <input type="text" id="nonce" /><br>
withCardSN: <select id="withCardSN">
  <option value="false" selected>false</option>
  <option value="true">true</option>
</select><br>
<input type="button" value="簽章" onclick="getICToken().goodDay(sign)"><br>
<hr>
cardSN (卡號): <input type="text" id="cardSN" /><br>
ret_code (結果): <input type="text" id="ret_code" /><br>
signature (簽章值)<br>
<textarea id="signature" rows="8" cols="65"></textarea><br>
<div id="info"></div>

<script src="https://fido.moi.gov.tw/pt/assets/ChtICToken.js"></script>
  
      <script id="rendered-js" >
function setData() {
  const icToken = getICToken();
  console.log(icToken);
  document.getElementById("info").innerHTML = JSON.stringify(icToken);
  document.getElementById("cardSN").value = icToken.SmrtCrdID[0];
  document.getElementById("ret_code").value = icToken.RetObj.RCode;
  document.getElementById("signature").value = icToken.RetObj.B64Signature;
}

function sign() {
  const icToken = getICToken();
  const tbs = btoa(document.getElementById("tbs").value);
  const pin = document.getElementById("pin").value;
  const hashAlgorithm = document.getElementById("hashAlgorithm").value;
  const signatureType = document.getElementById("signatureType").value;
  const keyidb64 = btoa("KEYX");
  const nonce = document.getElementById("nonce").value;
  const withSigningTime = "true";
  const withCardSN = document.getElementById("withCardSN").value;
  const checkValidity = "true";
  icToken.sign(tbs, pin, hashAlgorithm, setData, signatureType, keyidb64, nonce, withSigningTime, withCardSN, checkValidity);
}
//# sourceURL=pen.js
    </script>

  
</body>

</html>
